<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aloha.autoplay.mapper.AutoPlayMapper">

    <!-- 단위별 오토플레이 -->
    <select id="groupCount" resultType="java.util.Map">
        SELECT 
            <![CDATA[
                CASE 
                        WHEN total_play_time < (1 * 1000 * 60) THEN '0~1 분'
                        WHEN total_play_time < (3 * 1000 * 60) THEN '1~3 분'
                        WHEN total_play_time < (5 * 1000 * 60) THEN '3~5 분'
                        WHEN total_play_time < (10 * 1000 * 60) THEN '5~10 분'
                        WHEN total_play_time < (15 * 1000 * 60) THEN '10~15 분'
                        WHEN total_play_time < (20 * 1000 * 60) THEN '15~20 분'
                        ELSE '20분~'
                END AS play_time_range,
                COUNT(*) AS count
            ]]>
        FROM
        (
            SELECT username, SUM(play_time) as total_play_time
            FROM autoplay
            GROUP BY username
            ORDER BY total_play_time DESC
        ) user_play_time
        GROUP BY play_time_range
        ORDER BY play_time_range
    </select>

</mapper>
